---
import { getCollection } from "astro:content";
import Base from "../../../layouts/Base.astro";
import Breadcrumbs from "../../../components/Breadcrumbs.astro";
import SocialShare from "../../../components/SocialShare.astro";
import Hashtags from "../../../components/Hashtags.astro";
import { useTranslations } from "../../../i18n/config";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts
    .filter((post) => !post.data.draft && post.data.lang === 'es')
    .map((post) => ({
      params: { slug: post.slug },
      props: { post },
    }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const t = useTranslations('es');
---

<Base title={post.data.title} description={post.data.description} image={post.data.image}>
  <!-- Breadcrumbs -->
  <Breadcrumbs items={[
    { label: t('nav.home'), href: "/es/" },
    { label: t('nav.blog'), href: "/es/blog/" },
    { label: post.data.title }
  ]} />

  <!-- Post Header -->
  <header class="mb-12">
    <div class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-bold mb-6 leading-tight">{post.data.title}</h1>
      {post.data.description && (
        <p class="text-xl text-slate-600 max-w-3xl mx-auto leading-relaxed">{post.data.description}</p>
      )}
    </div>
    
    <div class="flex flex-col md:flex-row items-center justify-between gap-4 text-sm text-slate-500 border-t border-b border-slate-200 py-4">
      <div class="flex items-center gap-4">
        <span class="font-medium">{new Date(post.data.pubDate).toLocaleDateString('es-ES')}</span>
        {post.data.author && (
          <span>{t('blog.by')} {post.data.author}</span>
        )}
        {post.data.readingTime && (
          <span>{post.data.readingTime} {t('blog.minRead')}</span>
        )}
      </div>
      <SocialShare title={post.data.title} url={Astro.url.href} />
    </div>
  </header>

  <!-- Post Content -->
  <article class="prose prose-lg max-w-none">
    <Content />
  </article>

  <!-- Hashtags -->
  {post.data.hashtags && post.data.hashtags.length > 0 && (
    <div class="mt-8 pt-6 border-t border-slate-200">
      <h3 class="text-sm font-medium text-slate-700 mb-3">Etiquetas</h3>
      <Hashtags hashtags={post.data.hashtags} />
    </div>
  )}

  <!-- Post Footer -->
  <footer class="mt-12 pt-8 border-t border-slate-200">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
      <a 
        href="/es/blog/" 
        class="text-blue-600 hover:text-blue-700 font-medium transition-colors"
      >
        ‚Üê {t('blog.backToBlog')}
      </a>
      <SocialShare title={post.data.title} url={Astro.url.href} />
    </div>
  </footer>
</Base>
